<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Monitor ‚Äî OilRadar</title>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TZQ5VH3GPY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-TZQ5VH3GPY');
</script>
  
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Mono:wght@300;400;500&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root {
    --black: #080a0d;
    --deep: #0d1117;
    --panel: #111820;
    --border: #1e2d3d;
    --accent: #3b82f6;
    --accent-glow: rgba(59,130,246,0.12);
    --accent2: #ff4757;
    --gold: #f0a500;
    --text: #c8d6e5;
    --muted: #5a7a94;
    --white: #f0f4f8;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--black); color:var(--text); font-family:'DM Sans',sans-serif; overflow-x:hidden; min-height:100vh; display:flex; flex-direction:column; }
  body::before {
    content:''; position:fixed; inset:0; pointer-events:none; z-index:999;
    background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(59,130,246,0.012) 2px,rgba(59,130,246,0.012) 4px);
  }

  /* NAV */
  nav { position:fixed; top:0; left:0; right:0; z-index:100; display:flex; align-items:center; justify-content:space-between; padding:16px 48px; background:rgba(8,10,13,0.92); backdrop-filter:blur(12px); border-bottom:1px solid var(--border); }
  .logo { font-family:'Bebas Neue',sans-serif; font-size:22px; letter-spacing:4px; color:var(--accent); text-decoration:none; }
  .nav-cta { font-family:'DM Mono',monospace; font-size:11px; letter-spacing:2px; text-transform:uppercase; background:transparent; border:1px solid var(--accent); color:var(--accent); padding:8px 20px; cursor:pointer; transition:all .2s; text-decoration:none; }
  .nav-cta:hover { background:var(--accent); color:var(--white); }

  /* MAIN LAYOUT */
  main { flex:1; padding:120px 48px 80px; max-width:1400px; margin:0 auto; width:100%; }
  
  .section-label { font-family:'DM Mono',monospace; font-size:10px; letter-spacing:4px; text-transform:uppercase; color:var(--accent); margin-bottom:16px; }
  .section-title { font-family:'Bebas Neue',sans-serif; font-size:clamp(40px,5vw,60px); line-height:1; color:var(--white); margin-bottom:48px; }

  /* SIGNAL AREA */
  .monitor-container { display:grid; grid-template-columns:1fr; gap:32px; }
  
  .monitor-wrap { background:var(--panel); border:1px solid var(--border); padding:32px; box-shadow:0 20px 40px rgba(0,0,0,0.5); }
  .monitor-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:20px; }
  .monitor-title { font-family:'DM Mono',monospace; font-size:11px; letter-spacing:2px; text-transform:uppercase; color:var(--accent); }
  .live-dot { display:flex; align-items:center; gap:8px; font-family:'DM Mono',monospace; font-size:10px; color:var(--accent2); letter-spacing:2px; }
  .live-dot::before { content:''; width:8px; height:8px; background:var(--accent2); border-radius:50%; animation:blink 1.5s ease infinite; }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:.2} }
  
  .monitor-stat { font-family:'DM Mono',monospace; font-size:14px; color:var(--white); margin-bottom:24px; padding:12px 16px; background:rgba(59,130,246,0.06); border-left:2px solid var(--accent); display:flex; gap:24px; }
  
  .chart-wrapper { height:400px; width:100%; position:relative; }

  /* EXPLANATION CARDS */
  .explanation-grid { display:grid; grid-template-columns:1fr 1fr; gap:24px; margin-top:32px; }
  .explain-card { background:transparent; border:1px solid rgba(59,130,246,0.2); padding:24px; position:relative; }
  .explain-card.alert { border-color:rgba(255,71,87,0.3); background:rgba(255,71,87,0.02); }
  .explain-card h4 { font-family:'DM Mono',monospace; font-size:11px; letter-spacing:2px; text-transform:uppercase; color:var(--muted); margin-bottom:12px; }
  .explain-card.alert h4 { color:var(--accent2); }
  .explain-card p { font-size:13px; line-height:1.7; color:var(--text); }
  .explain-card strong { color:var(--white); font-weight:500; }

  /* FOOTER */
  footer { background:var(--panel); border-top:1px solid var(--border); padding:32px 48px; display:flex; align-items:center; justify-content:space-between; margin-top:auto; }
  .footer-logo { font-family:'Bebas Neue',sans-serif; font-size:24px; letter-spacing:6px; color:var(--accent); }
  .footer-text { font-family:'DM Mono',monospace; font-size:10px; letter-spacing:2px; color:var(--muted); }

  @media(max-width:900px){
    nav{padding:16px 24px}
    main{padding:100px 24px 60px}
    .explanation-grid { grid-template-columns:1fr; }
    .monitor-stat { flex-direction:column; gap:8px; }
  }
</style>
</head>
<body>

<nav>
  <a href="/" class="logo">OilRadar</a>
  <a href="/" class="nav-cta">‚Üê Back to Main</a>
</nav>

<main>
  <div class="section-label">Live Daily Feed (Last 3 Months)</div>
  <h1 class="section-title">Kharg Island Storage Monitor</h1>
  
  <div class="monitor-container">
    <div class="monitor-wrap">
      <div class="monitor-header">
        <div class="monitor-title">Daily Storage Dynamics ‚Äî SAR Extraction</div>
        <div class="live-dot">LIVE FEED</div>
      </div>
      
      <div class="monitor-stat" id="latestStat">
        Loading data...
      </div>
      
      <div class="chart-wrapper">
        <canvas id="dailyChart"></canvas>
      </div>

      <div class="explanation-grid">
        <div class="explain-card">
          <h4>üõ∞Ô∏è How The Radar Works</h4>
          <p>Oil storage tanks on Kharg Island use <strong>floating roofs</strong> that lower as oil is pumped out and rise as tanks fill. Sentinel-1 SAR (Synthetic Aperture Radar) signals bounce off the internal walls of the tank. A low roof creates a deep cavity, returning a brighter radar reflection. We invert this radiometric signal to calculate the physical volume in millions of barrels.</p>
        </div>
        <div class="explain-card alert">
          <h4>üìä Reading The Signal</h4>
          <p><strong>Rising Volume (Build):</strong> Oil is accumulating. This indicates a disruption or bottleneck in export logistics. Tankers are likely delayed or loading is slower than production.<br><br>
          <strong>Falling Volume (Draw):</strong> Active exporting. Tankers are actively draining the terminal, sending physical supply into the global market.</p>
        </div>
      </div>
    </div>
  </div>
</main>

<footer>
  <div class="footer-logo">OilRadar</div>
  <div class="footer-text">Satellite Intelligence for Physical Oil Markets</div>
</footer>

<script>
async function loadDailyMonitor() {
  try {
    // We assume data_daily.json is deployed to the root of the site (e.g. your public folder)
    const res = await fetch('/data_daily.json'); 
    const d = await res.json();
    
    // Get last 90 days (approx 3 months) of daily data
    const last90Dates = d.dates.slice(-90);
    const last90Values = d.values.slice(-90);

    const latest = last90Values[last90Values.length-1];
    const prev   = last90Values[last90Values.length-2];
    const diff   = (latest - prev).toFixed(2);
    const sign   = diff > 0 ? '+' : '';
    const trend  = diff > 0
      ? '<span style="color:#f0a500">‚ñ≤ INVENTORY BUILDING</span>'
      : '<span style="color:#3b82f6">‚ñº ACTIVE DRAWDOWN</span>';

    document.getElementById('latestStat').innerHTML =
      `<div>Latest Reading: <strong style="color:#3b82f6;">${latest.toFixed(2)} Mn Bbl</strong></div>
       <div>Day-over-Day: <strong style="color:${diff > 0 ? '#f0a500' : '#3b82f6'}">${sign}${diff} Mn Bbl</strong></div>
       <div>Status: <strong>${trend}</strong></div>`;

    new Chart(document.getElementById('dailyChart'), {
      type: 'line',
      data: {
        labels: last90Dates,
        datasets: [{
          label: 'Daily Est. Storage (Mn Bbl)',
          data: last90Values,
          borderColor: '#3b82f6',
          borderWidth: 2,
          backgroundColor: 'rgba(59,130,246,0.1)',
          fill: true,
          pointRadius: 2,
          pointBackgroundColor: '#111820',
          pointBorderColor: '#3b82f6',
          tension: 0.1,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {intersect:false, mode:'index'},
        scales: {
          x: {
            ticks: { color:'#5a7a94', font:{family:'DM Mono, monospace',size:10}, maxTicksLimit: 12 },
            grid: { color:'rgba(30,45,61,0.5)' }
          },
          y: {
            ticks: { color:'#5a7a94', font:{family:'DM Mono, monospace',size:11}, callback: v => v.toFixed(1)+' Mn' },
            grid: { color:'rgba(30,45,61,0.5)' }
          }
        },
        plugins: {
          legend: { display: false },
          tooltip: {
            backgroundColor:'#111820', borderColor:'#1e2d3d', borderWidth:1,
            titleColor:'#5a7a94', bodyColor:'#3b82f6',
            titleFont:{family:'DM Mono, monospace',size:11},
            bodyFont:{family:'DM Mono, monospace',size:14},
            callbacks: { label: ctx => ` Vol: ${ctx.parsed.y.toFixed(2)} Mn Bbl` }
          }
        }
      }
    });
  } catch(e) {
    document.getElementById('latestStat').innerHTML = '<span style="color:#ff4757">Error loading data. Are you sure data_daily.json is available at the root path?</span>';
    console.error("Error loading monitor data:", e);
  }
}

loadDailyMonitor();
</script>
</body>
</html>
